<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸ƒé¡†é¾ç Â·ä¸–ç•Œå†’éšª</title>
  <style>
    /* å…¨åŸŸæ¨£å¼ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Microsoft JhengHei', 'PingFang TC', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #eee;
      min-height: 100vh;
      padding: 20px;
    }

    /* ä¸»éŠæˆ²ç•«é¢ä¸–ç•Œåœ°åœ–èƒŒæ™¯ */
    #main-game {
      position: relative;
      min-height: 100vh;
      padding: 20px;
    }

    #main-game::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/World_map_blank_without_borders.svg/1280px-World_map_blank_without_borders.svg.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0.15;
      z-index: -2;
    }

    #main-game::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      z-index: -3;
    }

    /* é¦–é å®¹å™¨ */
    #homepage {
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }

    /* æ¨™é¡Œ */
    h1 {
      font-size: 2.5rem;
      margin-bottom: 30px;
      background: linear-gradient(45deg, #ffd700, #ff8c00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
    }

    /* YouTube å½±ç‰‡å®¹å™¨ */
    .video-container {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%; /* 16:9 æ¯”ä¾‹ */
      margin-bottom: 30px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
    }

    .video-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    /* è¦å‰‡èªªæ˜ */
    .rules {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 215, 0, 0.3);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
      text-align: left;
      line-height: 1.8;
    }
	
	.rules-container {
	  background: rgba(255, 255, 255, 0.12);
	  border: 1px solid rgba(255, 215, 0, 0.4);
	  border-radius: 16px;
	  padding: 20px 24px;
	  margin: 20px auto;
	  max-width: 750px;
	  color: #f8f8f8;
	  backdrop-filter: blur(6px);
	  box-shadow: 0 4px 16px rgba(0,0,0,0.35);
	  }
	  
	  .rules-title {
	  text-align: center;
	  margin-bottom: 12px;
	  font-size: 1.4rem;
	  font-weight: bold;
	  color: #ffe066;
	  letter-spacing: 1px;
	  }
	  
	  .rules-container p {
	  text-align: left;
	  line-height: 1.8;
	  margin-bottom: 14px;
	  font-size: 1rem;
	  }
	  
	  .rules-container .highlight {
	  color: #ffde59;
	  font-weight: bold;
	  }
	  
	  .rules-footer {
	  font-size: 1.05rem;
	  font-weight: bold;
	  color: #ffeaa7;
	  text-align: left;
	}
	
	/* RWDï¼šæ‰‹æ©Ÿç‰ˆèª¿æ•´å­—é«”å¤§å°èˆ‡è¡Œè· */
	@media (max-width: 480px) {
	.rules-container {
		padding: 16px 18px;
	}
	.rules-container p {
		font-size: 0.95rem;
		line-height: 1.5;
	}
	.rules-title {
		font-size: 1.25rem;
	}
	}

    /* é–‹å§‹å†’éšªæŒ‰éˆ• */
    .start-btn {
      background: linear-gradient(45deg, #ff6b6b, #ff8787);
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 1.3rem;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
      transition: all 0.3s ease;
    }

    .start-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(255, 107, 107, 0.6);
    }

    .start-btn:active {
      transform: translateY(-1px);
    }

    /* ä¸»ç•«é¢å®¹å™¨ */
    #main-game {
      display: none;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* é¾ç è¨ˆæ•¸å™¨ */
    .dragon-ball-counter {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 30px;
      font-weight: bold;
    }

    .dragon-ball-counter span {
      color: #ffd700;
      display: inline-block;
      transition: transform 0.3s ease;
    }

    .dragon-ball-counter span.pulse {
      animation: pulse 0.5s ease;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.3); }
    }

    /* å¡ç‰‡ç¶²æ ¼ */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    @media (min-width: 768px) {
      .cards-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 767px) {
      .cards-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* å¡ç‰‡æ¨£å¼ */
    .location-card {
      background: linear-gradient(145deg, rgba(45, 55, 100, 0.95), rgba(30, 40, 80, 0.95));
      border: 2px solid rgba(255, 215, 0, 0.5);
      border-radius: 15px;
      padding: 30px 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .location-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 15px 40px rgba(255, 215, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2);
      border-color: #ffd700;
      background: linear-gradient(145deg, rgba(55, 65, 120, 0.98), rgba(40, 50, 100, 0.98));
    }

    .location-card:active {
      transform: translateY(-4px);
    }

    .location-card h3 {
      font-size: 1.4rem;
      margin-bottom: 10px;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .location-card p {
      font-size: 0.9rem;
      color: #ccc;
    }

    /* å·²å®Œæˆå¡ç‰‡ */
    .location-card.completed {
      background: linear-gradient(145deg, rgba(80, 70, 30, 0.95), rgba(60, 50, 20, 0.95));
      border-color: #ffd700;
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    /* çœŸé¾ç ï¼šå³ä¸Šè§’ç™¼å…‰åœ“çƒ */
    .location-card.completed.real-dragon::before {
      content: 'ğŸŸ¡';
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 2rem;
      animation: glow 2s infinite;
    }

    /* å‡é¾ç ï¼šå³ä¸Šè§’å‡é¾ç åœ–ç¤º */
    .location-card.completed.fake-dragon::before {
      content: 'âšª';
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 2rem;
      opacity: 0.8;
    }

    @keyframes glow {
      0%, 100% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.1); }
    }

    .location-card.completed .completion-text {
      color: #ffd700;
      font-weight: bold;
      margin-top: 10px;
    }

    /* Modal æ¨£å¼ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease;
    }

    .modal.show {
      display: flex;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: linear-gradient(135deg, #2d3561 0%, #1f2544 100%);
      border: 2px solid #ffd700;
      border-radius: 20px;
      padding: 40px;
      max-width: 500px;
      width: 90%;
      text-align: center;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* å†·ç¬‘è©± Modal æ¨£å¼ */
    #joke-modal .modal-content {
      max-height: 90vh;
      overflow-y: auto;
      padding: 30px 20px;
    }

    .joke-image-container {
      max-height: 80vh;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
    }

    #joke-image {
      max-width: 100%;
      max-height: 80vh;
      height: auto;
      width: auto;
      object-fit: contain;
      border-radius: 10px;
    }

    /* é¾ç é¡å‹ Modal ç‰¹æ•ˆ */
    #dragonball-type-modal {
      background: rgba(0, 0, 0, 0.95);
      animation: fadeInSlow 0.8s ease;
    }

    @keyframes fadeInSlow {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    #dragonball-type-modal .modal-content {
      animation: dragonBallReveal 1.2s ease;
    }

    @keyframes dragonBallReveal {
      0% {
        transform: scale(0.3) rotateY(180deg);
        opacity: 0;
      }
      50% {
        transform: scale(1.1) rotateY(90deg);
        opacity: 0.7;
      }
      100% {
        transform: scale(1) rotateY(0deg);
        opacity: 1;
      }
    }

    #dragonball-type-icon {
      animation: iconGlow 2s ease-in-out infinite;
      display: inline-block;
    }

    @keyframes iconGlow {
      0%, 100% {
        transform: scale(1);
        filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
      }
      50% {
        transform: scale(1.1);
        filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.9));
      }
    }

    #dragonball-type-title {
      animation: titleFadeIn 1s ease 0.5s both;
    }

    @keyframes titleFadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    #dragonball-type-desc {
      animation: descFadeIn 1s ease 0.8s both;
    }

    @keyframes descFadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    #dragonball-type-btn {
      animation: btnFadeIn 1s ease 1.1s both;
    }

    @keyframes btnFadeIn {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .modal-content h2 {
      color: #ffd700;
      margin-bottom: 20px;
    }

    .modal-content .question {
      font-size: 1.2rem;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .modal-content .answer {
      display: none;
      background: rgba(255, 215, 0, 0.1);
      border: 1px dashed #ffd700;
      border-radius: 10px;
      padding: 15px;
      margin: 20px 0;
      font-size: 1.1rem;
      color: #ffd700;
    }

    .modal-content .answer.show {
      display: block;
    }

    .modal-btn {
      background: #ffd700;
      color: #1a1a2e;
      border: none;
      padding: 12px 30px;
      font-size: 1rem;
      border-radius: 25px;
      cursor: pointer;
      margin: 5px;
      transition: all 0.3s ease;
      font-weight: bold;
    }

    .modal-btn:hover {
      background: #ffed4e;
      transform: scale(1.05);
    }

    /* ç¥é¾å¬å–š Overlay */
    .dragon-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.5s ease;
    }

    .dragon-overlay.show {
      display: flex;
    }

    .dragon-content {
      text-align: center;
      animation: pulsing 2s infinite;
    }

    @keyframes pulsing {
      0%, 100% { transform: scale(1); opacity: 0.9; }
      50% { transform: scale(1.05); opacity: 1; }
    }

    .dragon-content h1 {
      font-size: 3rem;
      margin-bottom: 30px;
      text-shadow: 0 0 40px #ffd700;
    }

    .dragon-content .dragon-emoji {
      font-size: 8rem;
      margin-bottom: 30px;
      display: block;
      filter: drop-shadow(0 0 30px #ffd700);
    }

    .reset-btn {
      background: linear-gradient(45deg, #4ecdc4, #44a3a0);
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 1.2rem;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(78, 205, 196, 0.4);
      transition: all 0.3s ease;
    }

    .reset-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(78, 205, 196, 0.6);
    }

    /* é‡æ–°æŒ‘æˆ°æŒ‰éˆ•ï¼ˆå—ç¾æ´²é—œå¡ç”¨ï¼‰ */
    .restart-south-america-btn {
      background: linear-gradient(45deg, #E91E63, #C2185B);
      color: white;
      border: none;
      padding: 12px 30px;
      font-size: 1rem;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(233, 30, 99, 0.4);
      transition: all 0.3s ease;
      margin-top: 20px;
    }

    .restart-south-america-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(233, 30, 99, 0.6);
    }

    /* é ‚éƒ¨æŒ‰éˆ•å€ */
    .top-actions {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    /* éš±è—æ¨£å¼ */
    .hidden {
      display: none !important;
    }

    /* æ‰‹æ©Ÿç‰ˆèª¿æ•´ */
    @media (max-width: 767px) {
      h1 {
        font-size: 1.8rem;
      }

      .dragon-ball-counter {
        font-size: 1.5rem;
      }

      .location-card {
        padding: 20px 15px;
      }

      .location-card h3 {
        font-size: 1.1rem;
      }

      .dragon-content h1 {
        font-size: 2rem;
      }

      .dragon-content .dragon-emoji {
        font-size: 5rem;
      }
    }
  </style>
</head>
<body>

  <!-- é¦–é  -->
  <div id="homepage">
    <h1>ğŸ‰ ä¸ƒé¾ç â€”â€”ä¸–ç•Œå†’éšª ğŸ‰</h1>

    <!-- YouTube å½±ç‰‡å€å¡Š -->
    <div class="video-container">
      <iframe
        id="youtube-player"
        src="https://www.youtube.com/embed/08jyTTq1LF8?start=0&end=53&enablejsapi=1"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen>
      </iframe>
    </div>

    <!-- è¦å‰‡èªªæ˜ -->
	<br><br>
	<div class="rules-container">
	<h2 class="rules-title">ğŸŒŸ éŠæˆ²è¦å‰‡èªªæ˜</h2>
	
	<p>
        é€™æ¬¡å†’éšªå…±æœ‰ 11 ä½å°å‹‡å£«ï¼Œå¤§å®¶åŒå¿ƒå”åŠ›æ”¶é›†ä¸ƒé¡†çœŸæ­£çš„é¾ç ï¼Œæ‰èƒ½å¬å–šç¥é¾ä¸¦ç²å¾—æœ€çµ‚çš„å¯¶è—ï¼<br><br>
		
		æ¯ä¸€å›åˆç”±éšŠä¼æ¨æ´¾ä¸€äººæŠ½å–ä¸€é¡†é¾ç ï¼Œä¾ç…§é¾ç ä¸Šçš„æŒ‡ç¤ºå‰å¾€æŒ‘æˆ°ã€‚æŒ‘æˆ°å¯èƒ½æ˜¯:<br>
		   <strong>-éŠæˆ²ä»»å‹™</strong>ï¼šéœ€è¦å…¨éšŠåˆä½œæ‰èƒ½éé—œã€‚<br>
		   <strong>-çŒœè¬ä»»å‹™</strong>ï¼šéœ€è¦æ‰¾å‡ºæ­£ç¢ºè§£ç­”ã€‚<br>
		
		ç ´é—œå¾Œæ‰æœƒå¾—çŸ¥æŠ½å‡ºçš„é¾ç æ˜¯çœŸé¾ç ğŸŸ¡æˆ–å‡é¾ç âšªã€‚ <br><br>
		æ¯ä¸€é¡†é¾ç è—æœ‰ä¸€é“<strong>ç¥ç¥•æç¤º</strong>ï¼Œè«‹å°‡æ‰€æœ‰æç¤ºçµ„åˆèµ·ä¾†ï¼Œç ´è§£æœ€çµ‚çš„å’’èªï¼Œæ‰èƒ½çœŸæ­£å¬å–šç¥é¾ï¼
		è‹¥éšŠä¼åœ¨æ¢ç´¢é€”ä¸­æå‰æŠ½é½Šä¸ƒé¡†çœŸé¾ç ï¼Œå°‡æœƒè‡ªå‹•ç²å¾—æ‰€æœ‰å‰©é¤˜çš„é¾ç æç¤ºã€‚<br><br>
    </p>
	
	<p class="rules-footer">
		åœ¨å†’éšªçš„éç¨‹ä¸­ï¼Œè«‹å½¼æ­¤å°Šé‡ã€äº’ç›¸æ”¯æŒã€åœ˜çµåˆä½œï¼Œä¸€èµ·å°‹æ‰¾å±¬æ–¼ä½ å€‘çš„æœ€å¾Œå¯¶è—ï¼
	</p>
	</div>
    <!-- é–‹å§‹å†’éšªæŒ‰éˆ• -->
    <button class="start-btn" onclick="startAdventure()">ğŸš€ é–‹å§‹å†’éšª</button>
  </div>

  <!-- ä¸»ç•«é¢ -->
  <div id="main-game">
    <!-- é¾ç è¨ˆæ•¸å™¨ -->
    <div class="dragon-ball-counter">
      ç›®å‰é¾ç æ•¸é‡ï¼š<span id="ball-count">0</span> / 7
    </div>

    <!-- é ‚éƒ¨æŒ‰éˆ•å€ -->
    <div class="top-actions">
      <button class="restart-south-america-btn" onclick="restartAllChallenges()">ğŸ”„ é‡æ–°æŒ‘æˆ°ï¼ˆæ¸…é™¤æ‰€æœ‰é€²åº¦ï¼‰</button>
    </div>

    <!-- å¡ç‰‡ç¶²æ ¼ -->
    <div class="cards-grid" id="cards-grid">
      <!-- å¡ç‰‡å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
    </div>
  </div>

  <!-- é¾ç é¡å‹é¡¯ç¤ºå‹•ç•« -->
  <div class="modal" id="dragonball-type-modal">
    <div class="modal-content">
      <div id="dragonball-type-icon" style="font-size: 5rem; margin: 20px 0;">ğŸŸ¡</div>
      <h2 id="dragonball-type-title">çœŸé¾ç ä»»å‹™ï¼</h2>
      <p id="dragonball-type-desc" style="font-size: 1.1rem; margin: 20px 0;">éœ€è¦åœ˜éšŠåˆä½œç ´é—œ</p>
      <button class="modal-btn" id="dragonball-type-btn" onclick="proceedToLocation()">å‰å¾€æŒ‘æˆ°</button>
    </div>
  </div>

  <!-- å†·ç¬‘è©± Modal -->
  <div class="modal" id="joke-modal">
    <div class="modal-content">
      <h2 id="joke-title">å‡é¾ç ï¼</h2>
      <div class="joke-image-container">
        <img id="joke-image" src="" alt="åœ–ç‰‡">
      </div>
      <div class="question" id="joke-question">
        é€™è£¡æ˜¯å†·ç¬‘è©±æˆ–è¬èªçš„å…§å®¹...
      </div>
      <div class="answer" id="joke-answer">
        é€™è£¡æ˜¯ç­”æ¡ˆ...
      </div>
      <button class="modal-btn" id="show-answer-btn" onclick="showAnswer()">çœ‹ç­”æ¡ˆ</button>
      <button class="modal-btn" onclick="closeJokeModal()">è¿”å›åœ°åœ–</button>
    </div>
  </div>

  <!-- å‡é¾ç æ­ç¤º Overlay -->
  <div class="success-overlay" id="fake-reveal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 10000; justify-content: center; align-items: center;">
    <div class="success-content" style="text-align: center; animation: dragonBallReveal 1.2s ease;">
      <div style="font-size: 8rem; margin-bottom: 20px; animation: iconGlow 2s ease-in-out infinite;">âšª</div>
      <h2 style="font-size: 2.5rem; color: #ffd700; margin-bottom: 20px; animation: fadeInUp 1s ease 0.3s backwards;">ä»»å‹™å®Œæˆï¼</h2>
      <p style="font-size: 1.3rem; animation: fadeInUp 1s ease 0.6s backwards;">å’¦!? é€™è£¡æ²’æœ‰é¾ç :(</p>
    </div>
  </div>

  <!-- ç¥é¾å¬å–š Overlay -->
  <div class="dragon-overlay" id="dragon-overlay">
    <div class="dragon-content">
      <span class="dragon-emoji">ğŸ²</span>
      <h1>ä¸ƒé¡†é¾ç å·²æ”¶é›†å®Œç•¢!<br>åªå·®æœ€å¾Œä¸€æ­¥è§£é–‹å’’èª, ç¥é¾æ­£åœ¨ç­‰è‘—ä½ å€‘!</h1>
      <button class="reset-btn" onclick="restartGame()">ğŸ”„ å†ç©ä¸€æ¬¡</button>
    </div>
  </div>

  <!-- å¼•å…¥å…±ç”¨ JS -->
  <script src="js/shared.js"></script>

  <script>
    // åœ°é»è³‡æ–™
    const locations = [
      { key: 'arctic', name: 'åŒ—å†°æ´‹', type: 'real', emoji: 'ğŸ§Š',
        image: 'images/jokes/oceania.jpg',
        question: 'çŒœä¸€å€‹æ­·å²äººç‰©?',
        answer: 'æ‹¿ç ´è¼ª = æ‹¿ç ´å´™' },
	  { key: 'north-america', name: 'åŒ—ç¾æ´²', type: 'real', file: 'games/north-america.html', emoji: 'ğŸŒ' },
	  { key: 'antarctica', name: 'å—æ¥µæ´²', type: 'real', emoji: 'â„ï¸',
        image: 'images/jokes/antarctica.jpg',
        question: 'çœ‹åœ–çŒœæˆèªï¼Ÿ',
        answer: 'çŒ©ä¸è¼‰è¸ = å¿ƒä¸åœ¨ç„‰' },
	  { key: 'europe', name: 'æ­æ´²', type: 'joke', image: 'images/jokes/é­”äººæ™®çƒ.jpg', emoji: 'ğŸŒ',
        question: 'é­”äººæ™®çƒ: é€™è£¡æ²’æœ‰é¾ç !!' },
	  { key: 'atlantic', name: 'å¤§è¥¿æ´‹', type: 'joke', image: 'images/jokes/æ‚Ÿç©º.jpg', emoji: 'ğŸŒŠ',
        question: 'æ‚Ÿç©º: é€™è£¡æ²’æœ‰é¾ç !?' },
	  { key: 'asia', name: 'äºæ´²', type: 'real', file: 'games/asia.html', emoji: 'ğŸŒ' },
      
      { key: 'africa', name: 'éæ´²', type: 'real', file: 'games/africa.html', emoji: 'ğŸŒ' },
      { key: 'pacific', name: 'å¤ªå¹³æ´‹', type: 'real', emoji: 'ğŸŒŠ',
        image: 'images/jokes/pacific.jpg',
        question: 'çŒœå°ç£åœ°åï¼Ÿ',
        answer: 'å–µåŠ› = è‹—æ —' },

      { key: 'indian-ocean', name: 'å°åº¦æ´‹', type: 'joke', image: 'images/jokes/é¾œä»™äºº.jpg', emoji: 'ğŸŒŠ' ,
        question: 'é¾œä»™äºº: é€™è£¡æ²’æœ‰é¾ç !?'},

      { key: 'caribbean', name: 'å¤§æ´‹æ´²', type: 'joke', emoji: 'ğŸï¸',
        image: 'images/jokes/æ¯”å…‹å¤§é­”ç‹.jpg',
        question: 'æ¯”å…‹å¤§é­”ç‹: é€™è£¡æ²’æœ‰é¾ç !!'},

	  { key: 'south-america', name: 'å—ç¾æ´²', type: 'real', file: 'games/south-america.html', emoji: 'ğŸŒ' }

    ];

    // åˆå§‹åŒ–
    function init() {
      updateDragonBallDisplay();
      renderCards();
      checkDragonSummon();
    }

    // é–‹å§‹å†’éšª
    function startAdventure() {
      localStorage.setItem('gameStarted', 'true');
      document.getElementById('homepage').classList.add('hidden');
      document.getElementById('main-game').style.display = 'block';
      init();
    }

    // æ¸²æŸ“å¡ç‰‡
    function renderCards() {
      const grid = document.getElementById('cards-grid');
      grid.innerHTML = '';
      const completed = getCompletedLocations();

      locations.forEach((location, index) => {
        const card = document.createElement('div');
        card.className = 'location-card';

        const isCompleted = completed.includes(location.key);
        if (isCompleted) {
          card.classList.add('completed');
          // æ ¹æ“šé¡å‹åŠ ä¸Šå°æ‡‰çš„ class
          if (location.type === 'real') {
            card.classList.add('real-dragon');
          } else {
            card.classList.add('fake-dragon');
          }
        }

        let content = `
          <h3>${location.emoji} ${location.name}</h3>
        `;

        if (isCompleted && location.type === 'real') {
          // çœŸé¾ç ï¼šé¡¯ç¤ºã€Œå·²å–å¾—ç¬¬ X é¡†é¾ç ã€
          // è¨ˆç®—é€™æ˜¯ç¬¬å¹¾é¡†çœŸé¾ç ï¼ˆåªè¨ˆç®—çœŸé¾ç ï¼Œä¸åŒ…æ‹¬å‡é¾ç ï¼‰
          const realDragonKeys = ['asia', 'africa', 'south-america', 'arctic', 'north-america', 'pacific', 'antarctica'];
          const completedRealDragons = completed.filter(key => realDragonKeys.includes(key));
          const completionIndex = completedRealDragons.indexOf(location.key) + 1;
          content += `<p class="completion-text">å·²å–å¾—ç¬¬ ${completionIndex} é¡†é¾ç </p>`;
        }

        card.innerHTML = content;

        // é»æ“Šäº‹ä»¶
        card.addEventListener('click', () => {
          currentLocation = location;
          // ç›´æ¥é€²å…¥é—œå¡ï¼Œä¸é¡¯ç¤ºçœŸå‡é¾ç å‹•ç•«
          if (location.type === 'real') {
            window.location.href = location.file;
          } else {
            showJokeModal(location);
          }
        });

        grid.appendChild(card);
      });
    }

    // æ›´æ–°é¾ç é¡¯ç¤º
    function updateDragonBallDisplay() {
      const count = getDragonBallCount();
      const countElem = document.getElementById('ball-count');
      countElem.textContent = count;

      // åŠ å…¥è„ˆè¡å‹•ç•«
      countElem.classList.remove('pulse');
      void countElem.offsetWidth; // è§¸ç™¼ reflow
      countElem.classList.add('pulse');
    }

    // æš«å­˜ç•¶å‰é¸æ“‡çš„åœ°é»
    let currentLocation = null;

    // é¡¯ç¤ºé¾ç é¡å‹å‹•ç•«
    function showDragonBallTypeAnimation(location) {
      currentLocation = location;

      if (location.type === 'real') {
        // çœŸé¾ç 
        document.getElementById('dragonball-type-icon').textContent = 'ğŸŸ¡';
        document.getElementById('dragonball-type-title').textContent = 'çœŸé¾ç ä»»å‹™ï¼';
        document.getElementById('dragonball-type-desc').textContent = 'éœ€è¦åœ˜éšŠåˆä½œç ´é—œ';
        document.getElementById('dragonball-type-btn').textContent = 'å‰å¾€æŒ‘æˆ°';
      } else {
        // å‡é¾ç 
        document.getElementById('dragonball-type-icon').textContent = 'âšª';
        document.getElementById('dragonball-type-title').textContent = 'å‡é¾ç ä»»å‹™ï¼';
        document.getElementById('dragonball-type-desc').textContent = 'æœƒå‡ºç¾å†·ç¬‘è©±æˆ–è¬èª';
        document.getElementById('dragonball-type-btn').textContent = 'é–‹å§‹æŒ‘æˆ°';
      }

      document.getElementById('dragonball-type-modal').classList.add('show');
    }

    // å‰å¾€åœ°é»
    function proceedToLocation() {
      document.getElementById('dragonball-type-modal').classList.remove('show');

      if (currentLocation.type === 'real') {
        // å°å‘éŠæˆ²é é¢
        window.location.href = currentLocation.file;
      } else {
        // é¡¯ç¤ºå†·ç¬‘è©± modal
        showJokeModal(currentLocation);
      }
    }

    // é¡¯ç¤ºå†·ç¬‘è©± Modal
    function showJokeModal(location) {
      document.getElementById('joke-title').textContent = `${location.emoji} ${location.name}`;
      document.getElementById('joke-image').src = location.image || '';
      document.getElementById('joke-question').textContent = location.question;
      document.getElementById('joke-answer').textContent = location.answer;
      document.getElementById('joke-answer').classList.remove('show');
      
      // joke é¡å‹ä¸é¡¯ç¤ºã€Œçœ‹ç­”æ¡ˆã€æŒ‰éˆ•ï¼Œåªä¿ç•™ã€Œè¿”å›åœ°åœ–ã€
      if (location.type === 'joke') {
        document.getElementById('show-answer-btn').style.display = 'none';
      } else {
        document.getElementById('show-answer-btn').style.display = 'inline-block';
      }
      document.getElementById('joke-modal').classList.add('show');
    }

    // é¡¯ç¤ºç­”æ¡ˆ
    function showAnswer() {
      document.getElementById('joke-answer').classList.add('show');
      document.getElementById('show-answer-btn').style.display = 'none';
    }

    // é—œé–‰å†·ç¬‘è©± Modal
    function closeJokeModal() {
      document.getElementById('joke-modal').classList.remove('show');

      // æ¨™è¨˜å‡é¾ç ä»»å‹™ç‚ºå·²å®Œæˆï¼ˆä½†ä¸å¢åŠ é¾ç æ•¸é‡ï¼‰
      if (currentLocation && currentLocation.type === 'joke') {
        const completed = getCompletedLocations();

        // å¦‚æœé‚„æ²’å®Œæˆï¼Œé¡¯ç¤ºæ­ç¤ºå‹•ç•«å¾Œæ¨™è¨˜ç‚ºå®Œæˆ
        if (!completed.includes(currentLocation.key)) {
          // é¡¯ç¤ºå‡é¾ç æ­ç¤ºå‹•ç•«
          document.getElementById('fake-reveal-overlay').style.display = 'flex';

          // 2ç§’å¾Œéš±è—æ­ç¤ºå‹•ç•«ï¼Œæ¨™è¨˜å®Œæˆä¸¦é‡æ–°æ¸²æŸ“å¡ç‰‡
          setTimeout(() => {
            document.getElementById('fake-reveal-overlay').style.display = 'none';

            completed.push(currentLocation.key);
            localStorage.setItem('completedLocations', JSON.stringify(completed));

            // é‡æ–°æ¸²æŸ“å¡ç‰‡ä»¥é¡¯ç¤ºå®Œæˆç‹€æ…‹ï¼ˆé¡¯ç¤ºâšªåœ–ç¤ºï¼‰
            renderCards();
          }, 2000);
        }
      }
    }

    // æª¢æŸ¥æ˜¯å¦å¬å–šç¥é¾
    function checkDragonSummon() {
      const count = getDragonBallCount();
      if (count >= 7) {
        document.getElementById('dragon-overlay').classList.add('show');
      }
    }

    // é‡æ–°é–‹å§‹éŠæˆ²
    function restartGame() {
      resetGame();
      localStorage.removeItem('gameStarted');
      document.getElementById('dragon-overlay').classList.remove('show');
      document.getElementById('main-game').style.display = 'none';
      document.getElementById('homepage').classList.remove('hidden');
      updateDragonBallDisplay();
    }

    // é‡æ–°æŒ‘æˆ°å…¨éƒ¨ï¼ˆæ¸…é™¤æ‰€æœ‰é€²åº¦ï¼‰
    function restartAllChallenges() {
      if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰é€²åº¦ï¼Œé‡æ–°æŒ‘æˆ°æ¯ä¸€é—œå—ï¼Ÿ')) {
        // æ¸…é™¤æ‰€æœ‰é€²åº¦
        resetGame();
        // é‡æ–°æ¸²æŸ“å¡ç‰‡
        renderCards();
        // æ›´æ–°é¾ç é¡¯ç¤º
        updateDragonBallDisplay();
      }
    }

    // YouTube API æ§åˆ¶ï¼ˆé™åˆ¶æ’­æ”¾æ™‚é–“ï¼‰
    let player;
    const START_TIME = 0;
    const END_TIME = 50;

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('youtube-player', {
        events: {
          'onStateChange': onPlayerStateChange
        }
      });
    }

    function onPlayerStateChange(event) {
      if (event.data == YT.PlayerState.PLAYING) {
        checkTime();
      }
    }

    function checkTime() {
      if (player && player.getCurrentTime) {
        const currentTime = player.getCurrentTime();
        if (currentTime >= END_TIME) {
          // åœåœ¨æœ€å¾Œä¸€ç§’ï¼Œä¸é‡è¤‡æ’­æ”¾
          player.pauseVideo();
          player.seekTo(END_TIME);
          return;
        }

        // æ¯ç§’æª¢æŸ¥ä¸€æ¬¡
        if (player.getPlayerState() === YT.PlayerState.PLAYING) {
          setTimeout(checkTime, 500);
        }
      }
    }

    // è¼‰å…¥ YouTube IFrame API
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    // é é¢è¼‰å…¥æ™‚æª¢æŸ¥æ˜¯å¦å¾é—œå¡è¿”å›
    window.addEventListener('DOMContentLoaded', function() {
      // æª¢æŸ¥ URL åƒæ•¸ï¼Œå¦‚æœæœ‰ ?map=true è¡¨ç¤ºå¾é—œå¡è¿”å›ï¼Œç›´æ¥é¡¯ç¤ºåœ°åœ–é 
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('map') === 'true') {
        // å¾é—œå¡è¿”å›ï¼Œç›´æ¥é¡¯ç¤ºåœ°åœ–é 
        document.getElementById('homepage').classList.add('hidden');
        document.getElementById('main-game').style.display = 'block';
        init();
        // æ¸…é™¤ URL åƒæ•¸é¿å…é‡æ–°æ•´ç†æ™‚åˆè·³åˆ°åœ°åœ–
        window.history.replaceState({}, document.title, window.location.pathname);
      }
      // å¦å‰‡é¡¯ç¤ºé¦–é è®“ç”¨æˆ¶çœ‹åˆ°éŠæˆ²è¦å‰‡
    });
  </script>

</body>
</html>
