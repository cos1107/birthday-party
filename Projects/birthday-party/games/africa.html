<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>éæ´²åœ‹æ——æŒ‘æˆ° - ä¸ƒé¾ç Â·ä¸–ç•Œå†’éšª</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Microsoft JhengHei', 'PingFang TC', sans-serif;
      background: linear-gradient(135deg, #8B4513 0%, #D2691E 50%, #CD853F 100%);
      color: #fff;
      min-height: 100vh;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }

    /* è£é£¾æ€§èƒŒæ™¯å…ƒç´  */
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background:
        radial-gradient(circle at 20% 50%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(255, 140, 0, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(205, 133, 63, 0.1) 0%, transparent 50%);
      animation: float 20s ease-in-out infinite;
      pointer-events: none;
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(30px, -30px) rotate(5deg); }
      66% { transform: translate(-20px, 20px) rotate(-5deg); }
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    .header {
      text-align: center;
      margin-bottom: 25px;
      animation: fadeInDown 0.6s ease;
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header h1 {
      font-size: 3rem;
      margin-bottom: 15px;
      text-shadow: 0 0 30px rgba(255, 215, 0, 0.8),
                   0 5px 10px rgba(0, 0, 0, 0.5);
      background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: shimmer 3s ease-in-out infinite;
    }

    @keyframes shimmer {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.3); }
    }

    .header p {
      font-size: 1.3rem;
      color: #ffd700;
      text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }

    /* è¦å‰‡èªªæ˜å€ */
    .rules-section {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border: 3px solid rgba(255, 215, 0, 0.6);
      border-radius: 25px;
      padding: 40px;
      margin-bottom: 30px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
      animation: fadeInUp 0.6s ease 0.2s backwards;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .rule-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .rule-header h2 {
      font-size: 2rem;
      color: #ffd700;
      margin-bottom: 10px;
      text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }

    .rule-content {
      font-size: 1.1rem;
      line-height: 1.8;
      margin-bottom: 20px;
      text-align: center;
    }

    .rule-highlight {
      background: rgba(255, 215, 0, 0.2);
      border-left: 5px solid #ffd700;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      font-weight: bold;
      text-align: center;
    }

    .start-game-btn {
      display: block;
      width: 100%;
      max-width: 300px;
      margin: 30px auto 0;
      padding: 20px 40px;
      font-size: 1.5rem;
      font-weight: bold;
      color: #fff;
      background: linear-gradient(45deg, #4CAF50, #45a049);
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
      transition: all 0.3s ease;
      animation: pulse-btn 2s ease-in-out infinite;
    }

    @keyframes pulse-btn {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .start-game-btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 12px 30px rgba(76, 175, 80, 0.6);
    }

    /* éŠæˆ²å€åŸŸ */
    .game-area {
      animation: fadeIn 0.6s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* é ‚éƒ¨è³‡è¨Šæ¬„ */
    .game-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      gap: 15px;
    }

    .progress-bar, .timer {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 215, 0, 0.5);
      border-radius: 15px;
      padding: 12px 20px;
      font-size: 1.2rem;
      font-weight: bold;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      flex: 1;
    }

    .progress-bar {
      color: #ffd700;
    }

    .timer {
      color: #fff;
      background: linear-gradient(135deg, #4CAF50, #45a049);
      transition: all 0.3s ease;
    }

    .timer.warning {
      color: #fff;
      background: linear-gradient(135deg, #ff6b6b, #ff5252);
      animation: pulse-timer 0.5s infinite;
      transform: scale(1.1);
    }

    @keyframes pulse-timer {
      0%, 100% { transform: scale(1.1); }
      50% { transform: scale(1.15); }
    }

    /* éŠæˆ²ä¸»å€åŸŸ - ä¸‰æ¬„å¸ƒå±€ */
    .game-main {
      display: grid;
      grid-template-columns: 1fr 2fr 1fr;
      gap: 15px;
      align-items: center;
      margin-bottom: 20px;
      min-height: 320px;
    }

    /* å·¦å³é¸é …å¡ç‰‡ */
    .option-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
      backdrop-filter: blur(10px);
      border: 3px solid rgba(255, 215, 0, 0.4);
      border-radius: 20px;
      padding: 25px 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 250px;
      position: relative;
      overflow: hidden;
    }

    .option-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, transparent, rgba(255, 215, 0, 0.1));
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .option-card:hover::before {
      opacity: 1;
    }

    .option-card:hover {
      transform: translateY(-10px) scale(1.05);
      border-color: rgba(255, 215, 0, 0.8);
      box-shadow: 0 15px 40px rgba(255, 215, 0, 0.3);
    }

    .option-card.disabled {
      pointer-events: none;
      opacity: 0.5;
      cursor: not-allowed;
    }

    .option-card.selected {
      border-color: #4CAF50;
      background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(76, 175, 80, 0.2));
      transform: scale(1.05);
    }

    .option-card.correct {
      border-color: #4CAF50;
      background: linear-gradient(135deg, rgba(76, 175, 80, 0.4), rgba(76, 175, 80, 0.3));
      animation: correct-bounce 0.6s ease;
    }

    .option-card.wrong {
      border-color: #ff6b6b;
      background: linear-gradient(135deg, rgba(255, 107, 107, 0.4), rgba(255, 107, 107, 0.3));
      animation: wrong-shake 0.6s ease;
    }

    @keyframes correct-bounce {
      0%, 100% { transform: scale(1.05); }
      50% { transform: scale(1.15); }
    }

    @keyframes wrong-shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    .option-side {
      font-size: 2.5rem;
      margin-bottom: 15px;
      filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.3));
    }

    .option-country {
      font-size: 1.5rem;
      font-weight: bold;
      text-align: center;
      text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      position: relative;
      z-index: 1;
    }

    /* ä¸­é–“åœ‹æ——å€åŸŸ */
    .flag-section {
      background: rgba(255, 255, 255, 0.95);
      border: 4px solid rgba(255, 215, 0, 0.8);
      border-radius: 25px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 300px;
      position: relative;
    }

    .flag-title {
      color: #8B4513;
      font-size: 1.5rem;
      margin-bottom: 20px;
      font-weight: bold;
      text-align: center;
    }

    .flag-display {
      width: 100%;
      max-width: 300px;
      height: 180px;
      border: 3px solid #8B4513;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 9rem;
      background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
      margin-bottom: 15px;
      line-height: 1;
      font-family: "Segoe UI Emoji", "Apple Color Emoji", "Noto Color Emoji", sans-serif;
      overflow: hidden;
    }

    .flag-display img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    /* å›é¥‹è¨Šæ¯ */
    .feedback {
      text-align: center;
      font-size: 1.3rem;
      font-weight: bold;
      margin: 15px 0;
      min-height: 35px;
      text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      animation: fadeInScale 0.3s ease;
    }

    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .feedback.correct {
      color: #4CAF50;
    }

    .feedback.wrong {
      color: #ff6b6b;
    }

    .feedback.timeout {
      color: #ff9800;
    }

    /* å‹•ä½œæŒ‰éˆ•å€ */
    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 30px;
      font-size: 1.1rem;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .btn-next {
      background: linear-gradient(45deg, #2196F3, #1976D2);
      color: white;
    }

    .btn-next:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(33, 150, 243, 0.5);
    }

    .btn-restart {
      background: linear-gradient(45deg, #ff9800, #f57c00);
      color: white;
    }

    .btn-restart:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(255, 152, 0, 0.5);
    }

    .btn-show-answer {
      background: linear-gradient(45deg, #9C27B0, #7B1FA2);
      color: white;
    }

    .btn-show-answer:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(156, 39, 176, 0.5);
    }

    .btn-back {
      background: linear-gradient(45deg, #757575, #616161);
      color: white;
    }

    .btn-back:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(117, 117, 117, 0.5);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* æˆåŠŸ/æ­ç¤º Overlay */
    .success-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 10000;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease;
    }

    .success-overlay.show {
      display: flex;
    }

    .success-content {
      text-align: center;
      animation: bounceIn 0.6s ease;
    }

    @keyframes bounceIn {
      0% { transform: scale(0.3); opacity: 0; }
      50% { transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { transform: scale(1); opacity: 1; }
    }

    .success-content h2 {
      font-size: 2.5rem;
      color: #ffd700;
      margin-bottom: 20px;
    }

    .success-content p {
      font-size: 1.3rem;
      margin-bottom: 30px;
    }

    /* é¾ç æ­ç¤ºå‹•ç•« */
    @keyframes dragonBallReveal {
      0% {
        transform: scale(0.3) rotateY(180deg);
        opacity: 0;
      }
      50% {
        transform: scale(1.1) rotateY(90deg);
        opacity: 0.7;
      }
      100% {
        transform: scale(1) rotateY(0deg);
        opacity: 1;
      }
    }

    @keyframes iconGlow {
      0%, 100% {
        filter: drop-shadow(0 0 20px #ffd700);
      }
      50% {
        filter: drop-shadow(0 0 40px #ffd700);
      }
    }

    @keyframes fadeInUp2 {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 968px) {
      .game-main {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .option-card {
        min-height: auto;
        padding: 20px;
        flex-direction: row;
        justify-content: center;
        gap: 20px;
      }

      .option-side {
        font-size: 2rem;
        margin-bottom: 0;
      }

      .option-country {
        font-size: 1.5rem;
      }

      .flag-section {
        order: -1;
        padding: 30px 20px;
        min-height: 320px;
      }

      .flag-display {
        max-width: 280px;
        height: 180px;
        font-size: 6rem;
      }

      .flag-title {
        font-size: 1.5rem;
        margin-bottom: 20px;
      }

      .game-info {
        flex-direction: column;
        gap: 10px;
      }

      .progress-bar, .timer {
        width: 100%;
      }

      .header h1 {
        font-size: 2rem;
      }

      .btn {
        padding: 12px 30px;
        font-size: 1rem;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 10px;
      }

      .rules-section {
        padding: 25px 20px;
      }

      .rule-header h2 {
        font-size: 1.5rem;
      }

      .rule-content {
        font-size: 1rem;
      }

      .flag-display {
        max-width: 220px;
        height: 140px;
        font-size: 4rem;
      }

      .action-buttons {
        flex-direction: column;
      }

      .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <!-- æ¨™é¡Œå€ -->
    <div class="header">
      <h1>ğŸŒ éæ´²åœ‹æ——æŒ‘æˆ°</h1>
      <p>èªè­˜éæ´²å„åœ‹çš„æ——å¹Ÿï¼</p>
    </div>

    <!-- è¦å‰‡èªªæ˜å€ -->
    <div id="rules-section" class="rules-section">
      <div class="rule-header">
        <h2>ğŸ éæ´²åœ‹æ——è©¦ç…‰è¦å‰‡ ğŸŒ</h2>
      </div>

      <div class="rule-content">
        <p>éæ´²é—œå¡çš„åœ‹æ——è©¦ç…‰æ­£å¼é–‹å§‹ï¼æ¯ä¸€é¡Œæœƒå‡ºç¾ä¸€é¢ç¥ç§˜çš„éæ´²åœ‹æ——ï¼Œç­”æ¡ˆæœƒåˆ†æˆ<strong>å·¦å³å…©é‚Šçš„é¸é …</strong>ï¼Œå°å‹‡å£«å€‘å¿…é ˆè¦ªè‡ªç«™åˆ°è‡ªå·±ç›¸ä¿¡çš„é‚£ä¸€å´ã€‚</p>
      </div>

      <div class="rule-highlight">
        é¸æ“‡<strong>æ­£ç¢º</strong>çš„ä¸€æ–¹ï¼Œå¯ä»¥ç¹¼çºŒç•™ä¸‹ä¾†è¿æ¥ä¸‹ä¸€é¡Œï¼›<br>
        é¸æ“‡<strong>éŒ¯èª¤</strong>çš„ä¸€æ–¹ï¼Œå°‡æš«æ™‚é€€å‡ºé€™å ´è©¦ç…‰ï¼Œç„¡æ³•å†åƒèˆ‡å¾ŒçºŒç­”é¡Œã€‚
      </div>

      <div class="rule-content">
        <p style="font-size: 1.2rem; color: #ffd700;">
          åªè¦ 11 ä½å°å‹‡å£«ä¹‹ä¸­ï¼Œæœ‰ä»»ä½•ä¸€äººèƒ½åœ¨åœ‹æ——æŒ‘æˆ°ä¸­<strong>é€£çºŒç­”å°å…«é¡Œ</strong>ï¼Œ<br>
          å…¨éšŠä¾¿èƒ½ä¸€èµ·é€šééæ´²è©¦ç…‰ï¼
        </p>
      </div>

      <button class="start-game-btn" onclick="startGameFromRules()">ğŸš€ é–‹å§‹æŒ‘æˆ°</button>
    </div>

    <!-- éŠæˆ²å€åŸŸ -->
    <div class="game-area" id="game-area" style="display: none;">
      <!-- é ‚éƒ¨è³‡è¨Šæ¬„ -->
      <div class="game-info">
        <div class="progress-bar">
          é—œå¡é€²åº¦ï¼š<span id="current-question">0</span> / 8
        </div>
        <div class="timer" id="timer">
          å‰©é¤˜æ™‚é–“ï¼š<span id="time-left">10</span> ç§’
        </div>
      </div>

      <!-- éŠæˆ²ä¸»å€åŸŸ - ä¸‰æ¬„å¸ƒå±€ -->
      <div class="game-main">
        <!-- å·¦å´é¸é … -->
        <div class="option-card" id="option-left" onclick="selectAnswer(0)">
          <div class="option-side">â¬…ï¸</div>
          <div class="option-country" id="option-text-0">é¸é … A</div>
        </div>

        <!-- ä¸­é–“åœ‹æ—— -->
        <div class="flag-section">
          <div class="flag-title">é€™æ˜¯å“ªå€‹åœ‹å®¶çš„åœ‹æ——ï¼Ÿ</div>
          <div class="flag-display" id="flag-display">ğŸ</div>
        </div>

        <!-- å³å´é¸é … -->
        <div class="option-card" id="option-right" onclick="selectAnswer(1)">
          <div class="option-side">â¡ï¸</div>
          <div class="option-country" id="option-text-1">é¸é … B</div>
        </div>
      </div>

      <!-- å›é¥‹è¨Šæ¯ -->
      <div class="feedback" id="feedback"></div>

      <!-- å‹•ä½œæŒ‰éˆ• -->
      <div class="action-buttons">
        <button class="btn btn-show-answer" id="show-answer-btn" onclick="showAnswer()" style="display: none;">ğŸ‘ï¸ æŸ¥çœ‹æ­£ç¢ºç­”æ¡ˆ</button>
        <button class="btn btn-next" id="next-btn" onclick="nextQuestion()" style="display: none;">â¡ï¸ ä¸‹ä¸€é¡Œ</button>
        <button class="btn btn-restart" onclick="restartGame()">ğŸ”„ é‡æ–°é–‹å§‹</button>
        <button class="btn btn-back" onclick="goBack()">ğŸ—ºï¸ è¿”å›åœ°åœ–</button>
      </div>
    </div>
  </div>

  <!-- é¾ç æ­ç¤º Overlay -->
  <div class="success-overlay" id="reveal-overlay">
    <div class="success-content" style="animation: dragonBallReveal 1.2s ease;">
      <div style="font-size: 8rem; margin-bottom: 20px; animation: iconGlow 2s ease-in-out infinite;">ğŸŸ¡</div>
      <h2 style="animation: fadeInUp2 1s ease 0.3s backwards;">çœŸé¾ç ä»»å‹™å®Œæˆï¼</h2>
      <p style="animation: fadeInUp2 1s ease 0.6s backwards;">ä½ ç²å¾—äº†ä¸€é¡†çœŸé¾ç </p>
    </div>
  </div>

  <!-- æˆåŠŸå®Œæˆ Overlay -->
  <div class="success-overlay" id="success-overlay">
    <div class="success-content">
      <div style="font-size: 10rem; margin-bottom: 20px; animation: iconGlow 2s ease-in-out infinite;">ğŸŸ¡</div>
      <h2>æ­å–œï¼æŒ‘æˆ°æˆåŠŸï¼</h2>
      <p>ä½ å·²é€£çºŒç­”å° 8 é¡Œï¼ŒæˆåŠŸå®Œæˆéæ´²åœ‹æ——æŒ‘æˆ°ï¼</p>
      <button class="btn btn-back" onclick="goBack()">è¿”å›åœ°åœ–</button>
    </div>
  </div>

  <script src="../js/shared.js"></script>

  <script>
    const LOCATION_KEY = 'africa';

    // éæ´²åœ‹å®¶åœ‹æ——è³‡æ–™
    const africanFlags = [
      { country: 'åŸƒåŠ', flag: 'https://flagcdn.com/w320/eg.png', emoji: 'ğŸ‡ªğŸ‡¬' },
      { country: 'å—é', flag: 'https://flagcdn.com/w320/za.png', emoji: 'ğŸ‡¿ğŸ‡¦' },
      { country: 'å¥ˆåŠåˆ©äº', flag: 'https://flagcdn.com/w320/ng.png', emoji: 'ğŸ‡³ğŸ‡¬' },
      { country: 'è‚¯äº', flag: 'https://flagcdn.com/w320/ke.png', emoji: 'ğŸ‡°ğŸ‡ª' },
      { country: 'è¡£ç´¢æ¯”äº', flag: 'https://flagcdn.com/w320/et.png', emoji: 'ğŸ‡ªğŸ‡¹' },
      { country: 'æ‘©æ´›å“¥', flag: 'https://flagcdn.com/w320/ma.png', emoji: 'ğŸ‡²ğŸ‡¦' },
      { country: 'é˜¿çˆ¾åŠåˆ©äº', flag: 'https://flagcdn.com/w320/dz.png', emoji: 'ğŸ‡©ğŸ‡¿' },
      { country: 'çªå°¼è¥¿äº', flag: 'https://flagcdn.com/w320/tn.png', emoji: 'ğŸ‡¹ğŸ‡³' },
      { country: 'åŠ ç´', flag: 'https://flagcdn.com/w320/gh.png', emoji: 'ğŸ‡¬ğŸ‡­' },
      { country: 'çƒå¹²é”', flag: 'https://flagcdn.com/w320/ug.png', emoji: 'ğŸ‡ºğŸ‡¬' },
      { country: 'å¦å°šå°¼äº', flag: 'https://flagcdn.com/w320/tz.png', emoji: 'ğŸ‡¹ğŸ‡¿' },
      { country: 'å¡å…§åŠ çˆ¾', flag: 'https://flagcdn.com/w320/sn.png', emoji: 'ğŸ‡¸ğŸ‡³' },
      { country: 'è¾›å·´å¨', flag: 'https://flagcdn.com/w320/zw.png', emoji: 'ğŸ‡¿ğŸ‡¼' },
      { country: 'å–€éº¥éš†', flag: 'https://flagcdn.com/w320/cm.png', emoji: 'ğŸ‡¨ğŸ‡²' },
      { country: 'è±¡ç‰™æµ·å²¸', flag: 'https://flagcdn.com/w320/ci.png', emoji: 'ğŸ‡¨ğŸ‡®' },
      { country: 'å®‰å“¥æ‹‰', flag: 'https://flagcdn.com/w320/ao.png', emoji: 'ğŸ‡¦ğŸ‡´' },
      { country: 'é¦¬é”åŠ æ–¯åŠ ', flag: 'https://flagcdn.com/w320/mg.png', emoji: 'ğŸ‡²ğŸ‡¬' },
      { country: 'é¦¬åˆ©', flag: 'https://flagcdn.com/w320/ml.png', emoji: 'ğŸ‡²ğŸ‡±' },
      { country: 'å°šæ¯”äº', flag: 'https://flagcdn.com/w320/zm.png', emoji: 'ğŸ‡¿ğŸ‡²' },
      { country: 'ç´¢é¦¬åˆ©äº', flag: 'https://flagcdn.com/w320/so.png', emoji: 'ğŸ‡¸ğŸ‡´' }
    ];

    let currentQuestionIndex = 0;
    let correctAnswerIndex = 0;
    let timerInterval;
    let timeLeft = 10;
    let selectedAnswerIndex = null;
    let currentQuestions = [];

    // é–‹å§‹éŠæˆ²
    function startGameFromRules() {
      document.getElementById('rules-section').style.display = 'none';
      document.getElementById('game-area').style.display = 'block';
      initGame();
    }

    // åˆå§‹åŒ–éŠæˆ²
    function initGame() {
      currentQuestionIndex = 0;
      currentQuestions = selectRandomQuestions(8);
      loadQuestion();
    }

    // éš¨æ©Ÿé¸æ“‡ 8 é¡Œ
    function selectRandomQuestions(count) {
      const shuffled = [...africanFlags].sort(() => Math.random() - 0.5);
      return shuffled.slice(0, count);
    }

    // è¼‰å…¥é¡Œç›®
    function loadQuestion() {
      if (currentQuestionIndex >= currentQuestions.length) {
        completeChallenge();
        return;
      }

      // é‡ç½®ç‹€æ…‹
      selectedAnswerIndex = null;
      timeLeft = 10;
      document.getElementById('feedback').textContent = '';
      document.getElementById('feedback').className = 'feedback';
      document.getElementById('next-btn').style.display = 'none';
      document.getElementById('show-answer-btn').style.display = 'none';

      // é‡ç½®é¸é …å¡ç‰‡æ¨£å¼
      const optionLeft = document.getElementById('option-left');
      const optionRight = document.getElementById('option-right');
      optionLeft.className = 'option-card';
      optionRight.className = 'option-card';

      // æ›´æ–°é€²åº¦
      document.getElementById('current-question').textContent = currentQuestionIndex + 1;

      // å–å¾—ç•¶å‰é¡Œç›®
      const question = currentQuestions[currentQuestionIndex];

      // éš¨æ©Ÿé¸æ“‡å¦ä¸€å€‹åœ‹å®¶ä½œç‚ºéŒ¯èª¤é¸é …
      let wrongOption;
      do {
        wrongOption = africanFlags[Math.floor(Math.random() * africanFlags.length)];
      } while (wrongOption.country === question.country);

      // éš¨æ©Ÿæ±ºå®šæ­£ç¢ºç­”æ¡ˆåœ¨å·¦é‚Šé‚„æ˜¯å³é‚Š
      correctAnswerIndex = Math.random() < 0.5 ? 0 : 1;
      const options = correctAnswerIndex === 0
        ? [question.country, wrongOption.country]
        : [wrongOption.country, question.country];

      // é¡¯ç¤ºåœ‹æ——å’Œé¸é …
      const flagDisplay = document.getElementById('flag-display');
      flagDisplay.innerHTML = `<img src="${question.flag}" alt="${question.country}çš„åœ‹æ——" />`;
      document.getElementById('option-text-0').textContent = options[0];
      document.getElementById('option-text-1').textContent = options[1];

      // å•Ÿå‹•è¨ˆæ™‚å™¨
      startTimer();
    }

    // å•Ÿå‹•è¨ˆæ™‚å™¨
    function startTimer() {
      const timerElement = document.getElementById('timer');
      const timeLeftSpan = document.getElementById('time-left');

      timerElement.classList.remove('warning');
      timeLeftSpan.textContent = timeLeft;

      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeLeft--;
        timeLeftSpan.textContent = timeLeft;

        if (timeLeft <= 3) {
          timerElement.classList.add('warning');
        }

        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          handleTimeout();
        }
      }, 1000);
    }

    // è™•ç†è¶…æ™‚
    function handleTimeout() {
      // ç¦ç”¨é¸é …
      document.getElementById('option-left').classList.add('disabled');
      document.getElementById('option-right').classList.add('disabled');

      // é¡¯ç¤ºè¶…æ™‚è¨Šæ¯
      const feedbackElement = document.getElementById('feedback');
      feedbackElement.textContent = 'â° æ™‚é–“åˆ°ï¼å¯ä»¥æŸ¥çœ‹ç­”æ¡ˆæˆ–ç›´æ¥é€²å…¥ä¸‹ä¸€é¡Œ';
      feedbackElement.className = 'feedback timeout';

      // é¡¯ç¤ºæŸ¥çœ‹ç­”æ¡ˆæŒ‰éˆ•å’Œä¸‹ä¸€é¡ŒæŒ‰éˆ•
      document.getElementById('show-answer-btn').style.display = 'inline-block';
      document.getElementById('next-btn').style.display = 'inline-block';
    }

    // é¸æ“‡ç­”æ¡ˆ
    function selectAnswer(index) {
      if (selectedAnswerIndex !== null || timeLeft <= 0) return;

      selectedAnswerIndex = index;
      clearInterval(timerInterval);

      // æ¨™è¨˜é¸ä¸­çš„å¡ç‰‡
      const selectedCard = index === 0 ? document.getElementById('option-left') : document.getElementById('option-right');
      selectedCard.classList.add('selected');

      // ç¦ç”¨é¸é …
      document.getElementById('option-left').classList.add('disabled');
      document.getElementById('option-right').classList.add('disabled');

      // æª¢æŸ¥ç­”æ¡ˆ
      checkAnswer();
    }

    // æª¢æŸ¥ç­”æ¡ˆ
    function checkAnswer() {
      const feedbackElement = document.getElementById('feedback');
      const optionLeft = document.getElementById('option-left');
      const optionRight = document.getElementById('option-right');

      if (selectedAnswerIndex === correctAnswerIndex) {
        // ç­”å°
        feedbackElement.textContent = 'âœ… ç­”å°äº†ï¼å¤ªæ£’äº†ï¼';
        feedbackElement.className = 'feedback correct';

        const correctCard = correctAnswerIndex === 0 ? optionLeft : optionRight;
        correctCard.classList.remove('selected');
        correctCard.classList.add('correct');
      } else {
        // ç­”éŒ¯
        feedbackElement.textContent = 'âŒ ç­”éŒ¯äº†ï¼å†æ¥å†å²ï¼';
        feedbackElement.className = 'feedback wrong';

        const wrongCard = selectedAnswerIndex === 0 ? optionLeft : optionRight;
        wrongCard.classList.remove('selected');
        wrongCard.classList.add('wrong');

        // é¡¯ç¤ºæŸ¥çœ‹ç­”æ¡ˆæŒ‰éˆ•
        document.getElementById('show-answer-btn').style.display = 'inline-block';
      }

      // ç„¡è«–ç­”å°ç­”éŒ¯éƒ½é¡¯ç¤ºä¸‹ä¸€é¡ŒæŒ‰éˆ•
      document.getElementById('next-btn').style.display = 'inline-block';
    }

    // é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆ
    function showAnswer() {
      const correctCard = correctAnswerIndex === 0 ? document.getElementById('option-left') : document.getElementById('option-right');
      correctCard.classList.add('correct');

      // éš±è—æŸ¥çœ‹ç­”æ¡ˆæŒ‰éˆ•
      document.getElementById('show-answer-btn').style.display = 'none';

      // æ›´æ–°æç¤ºè¨Šæ¯
      const feedbackElement = document.getElementById('feedback');
      feedbackElement.textContent = 'ğŸ’¡ æ­£ç¢ºç­”æ¡ˆå·²æ¨™ç¤ºï¼ˆç¶ è‰²é‚Šæ¡†ï¼‰';
      feedbackElement.className = 'feedback';
    }

    // ä¸‹ä¸€é¡Œ
    function nextQuestion() {
      currentQuestionIndex++;
      loadQuestion();
    }

    // é‡æ–°é–‹å§‹
    function restartGame() {
      clearInterval(timerInterval);
      document.getElementById('rules-section').style.display = 'block';
      document.getElementById('game-area').style.display = 'none';
    }

    // å®ŒæˆæŒ‘æˆ°
    function completeChallenge() {
      clearInterval(timerInterval);

      // æª¢æŸ¥æ˜¯å¦å·²å®Œæˆé
      const completed = getCompletedLocations();
      const isNew = !completed.includes(LOCATION_KEY);

      if (isNew) {
        // é¡¯ç¤ºé¾ç æ­ç¤ºå‹•ç•«
        document.getElementById('reveal-overlay').classList.add('show');

        // 2ç§’å¾Œé¡¯ç¤ºæˆåŠŸé é¢
        setTimeout(() => {
          document.getElementById('reveal-overlay').classList.remove('show');
          markLocationCompleted(LOCATION_KEY);
          document.getElementById('success-overlay').classList.add('show');
        }, 2000);
      } else {
        // å·²å®Œæˆéï¼Œç›´æ¥é¡¯ç¤ºæˆåŠŸé é¢
        document.getElementById('success-overlay').classList.add('show');
      }
    }

    // è¿”å›åœ°åœ–
    function goBack() {
      window.location.href = '../index.html?map=true';
    }
  </script>

</body>
</html>
